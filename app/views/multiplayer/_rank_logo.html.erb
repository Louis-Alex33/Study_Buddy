<% case rank %>
<% when 'iron' %>
  <!-- NOVICE - Livre ouvert simple -->
  <svg viewBox="0 0 80 80" width="80" height="80">
    <defs>
      <linearGradient id="bookGray-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#8A8A8A"/>
        <stop offset="50%" style="stop-color:#5A5A5A"/>
        <stop offset="100%" style="stop-color:#3A3A3A"/>
      </linearGradient>
    </defs>
    <g transform="translate(40,40)">
      <rect x="-22" y="-15" width="20" height="28" rx="2" fill="url(#bookGray-<%= rank %>)" stroke="#2A2A2A" stroke-width="2"/>
      <rect x="2" y="-15" width="20" height="28" rx="2" fill="url(#bookGray-<%= rank %>)" stroke="#2A2A2A" stroke-width="2"/>
      <line x1="-18" y1="-10" x2="-6" y2="-10" stroke="#AFAFAF" stroke-width="1.5"/>
      <line x1="-18" y1="-5" x2="-6" y2="-5" stroke="#AFAFAF" stroke-width="1.5"/>
      <line x1="-18" y1="0" x2="-6" y2="0" stroke="#AFAFAF" stroke-width="1.5"/>
      <line x1="6" y1="-10" x2="18" y2="-10" stroke="#AFAFAF" stroke-width="1.5"/>
      <line x1="6" y1="-5" x2="18" y2="-5" stroke="#AFAFAF" stroke-width="1.5"/>
      <line x1="6" y1="0" x2="18" y2="0" stroke="#AFAFAF" stroke-width="1.5"/>
    </g>
  </svg>

<% when 'bronze' %>
  <!-- APPRENTI - Livre avec marque-page -->
  <svg viewBox="0 0 80 80" width="80" height="80">
    <defs>
      <linearGradient id="bookBronze-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#E5A85F"/>
        <stop offset="50%" style="stop-color:#CD7F32"/>
        <stop offset="100%" style="stop-color:#8B5A2B"/>
      </linearGradient>
    </defs>
    <g transform="translate(40,40)">
      <rect x="-22" y="-15" width="20" height="28" rx="2" fill="url(#bookBronze-<%= rank %>)" stroke="#6B4423" stroke-width="2"/>
      <rect x="2" y="-15" width="20" height="28" rx="2" fill="url(#bookBronze-<%= rank %>)" stroke="#6B4423" stroke-width="2"/>
      <rect x="-2" y="-18" width="4" height="22" fill="#D2691E"/>
      <line x1="-18" y1="-10" x2="-6" y2="-10" stroke="#F4E4C1" stroke-width="1.5"/>
      <line x1="-18" y1="-5" x2="-6" y2="-5" stroke="#F4E4C1" stroke-width="1.5"/>
      <line x1="6" y1="-10" x2="18" y2="-10" stroke="#F4E4C1" stroke-width="1.5"/>
      <line x1="6" y1="-5" x2="18" y2="-5" stroke="#F4E4C1" stroke-width="1.5"/>
      <circle cx="0" cy="8" r="3" fill="#FFD700" opacity="0.6"/>
    </g>
  </svg>

<% when 'silver' %>
  <!-- ÉTUDIANT - Crayon et livre -->
  <svg viewBox="0 0 80 80" width="80" height="80">
    <defs>
      <linearGradient id="bookSilver-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#E8E8E8"/>
        <stop offset="50%" style="stop-color:#C0C0C0"/>
        <stop offset="100%" style="stop-color:#A8A8A8"/>
      </linearGradient>
      <linearGradient id="pencilYellow-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#FFD700"/>
        <stop offset="100%" style="stop-color:#FFA500"/>
      </linearGradient>
    </defs>
    <g transform="translate(40,40)">
      <rect x="-20" y="-12" width="18" height="24" rx="2" fill="url(#bookSilver-<%= rank %>)" stroke="#888888" stroke-width="2"/>
      <rect x="5" y="-12" width="18" height="24" rx="2" fill="url(#bookSilver-<%= rank %>)" stroke="#888888" stroke-width="2"/>
      <rect x="-8" y="-18" width="6" height="32" rx="1" fill="url(#pencilYellow-<%= rank %>)" stroke="#CD7F32" stroke-width="1.5" transform="rotate(25 -5 0)"/>
      <polygon points="-5,-20 -8,-15 -2,-15" fill="#FF6347" transform="rotate(25 -5 0)"/>
      <line x1="-16" y1="-7" x2="-6" y2="-7" stroke="#FAFAFA" stroke-width="1"/>
      <line x1="-16" y1="-2" x2="-6" y2="-2" stroke="#FAFAFA" stroke-width="1"/>
      <line x1="9" y1="-7" x2="19" y2="-7" stroke="#FAFAFA" stroke-width="1"/>
      <line x1="9" y1="-2" x2="19" y2="-2" stroke="#FAFAFA" stroke-width="1"/>
    </g>
  </svg>

<% when 'gold' %>
  <!-- ÉRUDIT - Diplôme roulé -->
  <svg viewBox="0 0 80 80" width="80" height="80">
    <defs>
      <linearGradient id="diplomaGold-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#FFFACD"/>
        <stop offset="50%" style="stop-color:#FFD700"/>
        <stop offset="100%" style="stop-color:#DAA520"/>
      </linearGradient>
    </defs>
    <g transform="translate(40,40)">
      <ellipse cx="-15" cy="0" rx="6" ry="15" fill="url(#diplomaGold-<%= rank %>)" stroke="#B8860B" stroke-width="2"/>
      <rect x="-10" y="-15" width="20" height="30" rx="1" fill="url(#diplomaGold-<%= rank %>)" stroke="#B8860B" stroke-width="2"/>
      <ellipse cx="15" cy="0" rx="6" ry="15" fill="url(#diplomaGold-<%= rank %>)" stroke="#B8860B" stroke-width="2"/>
      <circle cx="0" cy="0" r="7" fill="none" stroke="#FF6347" stroke-width="2"/>
      <path d="M-4,-3 L-1,3 L4,-2" stroke="#FF6347" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      <line x1="-6" y1="-10" x2="6" y2="-10" stroke="#B8860B" stroke-width="1"/>
      <line x1="-6" y1="10" x2="6" y2="10" stroke="#B8860B" stroke-width="1"/>
      <rect x="-2" y="15" width="4" height="12" fill="#FF6347"/>
      <rect x="-4" y="25" width="8" height="6" fill="#FF6347" rx="1"/>
    </g>
  </svg>

<% when 'platinum' %>
  <!-- SAVANT - Loupe sur livre -->
  <svg viewBox="0 0 80 80" width="80" height="80">
    <defs>
      <linearGradient id="bookCyan-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#7FDBFF"/>
        <stop offset="50%" style="stop-color:#00CED1"/>
        <stop offset="100%" style="stop-color:#008B8B"/>
      </linearGradient>
    </defs>
    <g transform="translate(40,40)">
      <rect x="-20" y="-12" width="40" height="24" rx="2" fill="url(#bookCyan-<%= rank %>)" stroke="#006666" stroke-width="2"/>
      <line x1="-15" y1="-7" x2="15" y2="-7" stroke="#E0FFFF" stroke-width="1.5"/>
      <line x1="-15" y1="-2" x2="15" y2="-2" stroke="#E0FFFF" stroke-width="1.5"/>
      <line x1="-15" y1="3" x2="15" y2="3" stroke="#E0FFFF" stroke-width="1.5"/>
      <circle cx="10" cy="10" r="8" fill="none" stroke="#FFD700" stroke-width="3"/>
      <circle cx="10" cy="10" r="6" fill="#FFF" opacity="0.3"/>
      <line x1="16" y1="16" x2="22" y2="22" stroke="#FFD700" stroke-width="3" stroke-linecap="round"/>
    </g>
  </svg>

<% when 'emerald' %>
  <!-- EXPERT - Cerveau stylisé -->
  <svg viewBox="0 0 80 80" width="80" height="80">
    <defs>
      <linearGradient id="brainEmerald-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#90EE90"/>
        <stop offset="50%" style="stop-color:#50C878"/>
        <stop offset="100%" style="stop-color:#3CB371"/>
      </linearGradient>
    </defs>
    <g transform="translate(40,40)">
      <ellipse cx="0" cy="0" rx="20" ry="16" fill="url(#brainEmerald-<%= rank %>)" stroke="#228B22" stroke-width="2.5"/>
      <path d="M-15,-8 Q-12,-12 -8,-8 Q-4,-12 0,-8 Q4,-12 8,-8 Q12,-12 15,-8" stroke="#228B22" stroke-width="2" fill="none"/>
      <path d="M-15,0 Q-12,4 -8,0 Q-4,4 0,0 Q4,4 8,0 Q12,4 15,0" stroke="#228B22" stroke-width="2" fill="none"/>
      <path d="M-15,8 Q-12,12 -8,8" stroke="#228B22" stroke-width="2" fill="none"/>
      <path d="M8,8 Q12,12 15,8" stroke="#228B22" stroke-width="2" fill="none"/>
      <circle cx="-8" cy="-4" r="2" fill="#FFD700"/>
      <circle cx="8" cy="-4" r="2" fill="#FFD700"/>
      <circle cx="0" cy="4" r="2" fill="#FFD700"/>
    </g>
  </svg>

<% when 'diamond' %>
  <!-- MAÎTRE - Chapeau de graduation -->
  <svg viewBox="0 0 80 80" width="80" height="80">
    <defs>
      <linearGradient id="capDiamond-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#E0FFFF"/>
        <stop offset="50%" style="stop-color:#B9F2FF"/>
        <stop offset="100%" style="stop-color:#87CEEB"/>
      </linearGradient>
    </defs>
    <g transform="translate(40,40)">
      <polygon points="0,-15 -25,0 0,8 25,0" fill="url(#capDiamond-<%= rank %>)" stroke="#4682B4" stroke-width="2.5"/>
      <rect x="-15" y="5" width="30" height="3" fill="url(#capDiamond-<%= rank %>)" stroke="#4682B4" stroke-width="2"/>
      <line x1="0" y1="-15" x2="0" y2="20" stroke="#FFD700" stroke-width="2"/>
      <polygon points="0,20 -3,15 3,15" fill="#FFD700"/>
      <circle cx="0" cy="22" r="2" fill="#FFD700"/>
      <path d="M-20,-2 L-20,8 Q-20,12 0,12 Q20,12 20,8 L20,-2" fill="none" stroke="#4682B4" stroke-width="2"/>
    </g>
  </svg>

<% when 'master' %>
  <!-- VIRTUOSE - Étoile académique -->
  <svg viewBox="0 0 80 80" width="80" height="80">
    <defs>
      <linearGradient id="starPurple-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#DA70D6"/>
        <stop offset="50%" style="stop-color:#9B30FF"/>
        <stop offset="100%" style="stop-color:#7B27B8"/>
      </linearGradient>
    </defs>
    <g transform="translate(40,40)">
      <polygon points="0,-20 5,-7 19,-7 9,2 13,15 0,7 -13,15 -9,2 -19,-7 -5,-7" fill="url(#starPurple-<%= rank %>)" stroke="#4B0082" stroke-width="2.5"/>
      <circle cx="0" cy="0" r="8" fill="#FFD700" stroke="#FFA500" stroke-width="2"/>
      <text x="0" y="5" font-size="12" font-weight="bold" fill="#4B0082" text-anchor="middle" font-family="Arial">M</text>
      <circle cx="-8" cy="-10" r="2" fill="#FFD700"/>
      <circle cx="8" cy="-10" r="2" fill="#FFD700"/>
      <circle cx="-10" cy="8" r="2" fill="#FFD700"/>
      <circle cx="10" cy="8" r="2" fill="#FFD700"/>
    </g>
  </svg>

<% when 'grandmaster' %>
  <!-- GÉNIE - Ampoule brillante -->
  <svg viewBox="0 0 80 80" width="80" height="80">
    <defs>
      <linearGradient id="bulbOrange-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#FFD700"/>
        <stop offset="50%" style="stop-color:#FF8C00"/>
        <stop offset="100%" style="stop-color:#FF4500"/>
      </linearGradient>
      <radialGradient id="glowBulb-<%= rank %>">
        <stop offset="0%" style="stop-color:#FFFF00;stop-opacity:0.8"/>
        <stop offset="100%" style="stop-color:#FF8C00;stop-opacity:0"/>
      </radialGradient>
    </defs>
    <g transform="translate(40,40)">
      <circle cx="0" cy="0" rx="18" ry="18" fill="url(#glowBulb-<%= rank %>)"/>
      <ellipse cx="0" cy="-3" rx="12" ry="15" fill="url(#bulbOrange-<%= rank %>)" stroke="#DC143C" stroke-width="2.5"/>
      <rect x="-6" y="12" width="12" height="4" rx="1" fill="#C0C0C0" stroke="#808080" stroke-width="1.5"/>
      <rect x="-5" y="16" width="10" height="3" rx="1" fill="#C0C0C0" stroke="#808080" stroke-width="1.5"/>
      <line x1="-18" y1="-5" x2="-22" y2="-8" stroke="#FFD700" stroke-width="2" stroke-linecap="round"/>
      <line x1="-15" y1="-12" x2="-17" y2="-17" stroke="#FFD700" stroke-width="2" stroke-linecap="round"/>
      <line x1="18" y1="-5" x2="22" y2="-8" stroke="#FFD700" stroke-width="2" stroke-linecap="round"/>
      <line x1="15" y1="-12" x2="17" y2="-17" stroke="#FFD700" stroke-width="2" stroke-linecap="round"/>
      <path d="M-6,-5 Q0,-8 6,-5" stroke="#FFA500" stroke-width="2" fill="none"/>
    </g>
  </svg>

<% when 'challenger' %>
  <!-- LÉGENDE - Trophée avec étoiles -->
  <svg viewBox="0 0 80 80" width="80" height="80">
    <defs>
      <linearGradient id="trophyGold-<%= rank %>" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#FFEC8B"/>
        <stop offset="40%" style="stop-color:#FFD700"/>
        <stop offset="100%" style="stop-color:#DAA520"/>
      </linearGradient>
      <radialGradient id="starGlow-<%= rank %>">
        <stop offset="0%" style="stop-color:#FFFF00;stop-opacity:0.6"/>
        <stop offset="100%" style="stop-color:#FFD700;stop-opacity:0"/>
      </radialGradient>
    </defs>
    <g transform="translate(40,40)">
      <ellipse cx="0" cy="0" rx="30" ry="25" fill="url(#starGlow-<%= rank %>)" opacity="0.5"/>
      <path d="M-12,-15 L-12,5 Q-12,10 0,10 Q12,10 12,5 L12,-15 Q12,-18 8,-18 L-8,-18 Q-12,-18 -12,-15 Z" fill="url(#trophyGold-<%= rank %>)" stroke="#B8860B" stroke-width="2.5"/>
      <ellipse cx="0" cy="-15" rx="12" ry="3" fill="url(#trophyGold-<%= rank %>)" stroke="#B8860B" stroke-width="2"/>
      <rect x="-3" y="10" width="6" height="8" fill="url(#trophyGold-<%= rank %>)" stroke="#B8860B" stroke-width="2"/>
      <rect x="-10" y="18" width="20" height="4" rx="1" fill="url(#trophyGold-<%= rank %>)" stroke="#B8860B" stroke-width="2"/>
      <path d="M-18,-10 Q-22,-8 -20,-3 L-12,-5" fill="url(#trophyGold-<%= rank %>)" stroke="#B8860B" stroke-width="2"/>
      <path d="M18,-10 Q22,-8 20,-3 L12,-5" fill="url(#trophyGold-<%= rank %>)" stroke="#B8860B" stroke-width="2"/>
      <polygon points="0,-12 1,-9 4,-9 2,-7 3,-4 0,-6 -3,-4 -2,-7 -4,-9 -1,-9" fill="#FF6347"/>
      <polygon points="-15,-20 -14,-18 -12,-18 -13,-17 -12,-15 -15,-16 -18,-15 -17,-17 -19,-18 -16,-18" fill="#FFD700" opacity="0.8"/>
      <polygon points="15,-20 16,-18 18,-18 17,-17 18,-15 15,-16 12,-15 13,-17 11,-18 14,-18" fill="#FFD700" opacity="0.8"/>
    </g>
  </svg>

<% else %>
  <div class="rank-text-fallback" style="font-size: 2rem; font-weight: bold; color: #e0e0e0;">
    <%= rank.upcase %>
  </div>
<% end %>
