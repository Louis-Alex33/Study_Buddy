<div class="container my-5">
  <!-- Header Section -->
  <div class="lectures-header">
    <div class="lectures-header-content">
      <h1>Mes Lectures</h1>
      <p>Toutes tes lectures en un seul endroit</p>
    </div>
  </div>

  <div class="lectures-content" data-controller="tabs">
    <% if @lectures.any? || @quizzes.any? %>
      <div class="filter_button_card">
        <button class="filter_button active" data-tabs-target="button" data-action="click->tabs#switch" data-tab="all">
          ALL
        </button>
        <% @categories.each do |category| %>
          <button class="filter_button" data-tabs-target="button" data-action="click->tabs#switch" data-tab="<%= category.title.parameterize %>">
            <%= category.title %>
          </button>
        <% end %>
        <button class="filter_button" data-tabs-target="button" data-action="click->tabs#switch" data-tab="quizz">
          ğŸ§  QUIZZ
        </button>
      </div>

      <!-- All Lectures View -->
      <div class="tab-pane active" data-tabs-target="content" data-tab="all">
        <div class="lectures-grid">
        <% current_user.lectures.each do |lecture| %>
        <div class="lecture-card">
          <span class="lecture-card-badge">
            <%= lecture.category.title %>
          </span>

          <h3 class="lecture-card-title">
            <%= lecture.title %>
          </h3>

          <p class="lecture-card-resume">
            <%= lecture.resume %>
          </p>

          <div class="lecture-card-stats">
            <div class="stat-item">
              <div class="stat-number">
                <%= lecture.flashcards.count %>
              </div>
              <div class="stat-label">
                Flashcards
              </div>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
              <div class="stat-number">
                <%= lecture.messages.count %>
              </div>
              <div class="stat-label">
                Messages
              </div>
            </div>
          </div>

          <div class="lecture-card-actions">
            <%= link_to lecture_path(lecture), class: "btn-view-lecture" do %>
              <span>Voir la lecture</span>
              <span>â†’</span>
            <% end %>
            <%= button_to lecture_path(lecture), method: :delete, data: { turbo_confirm: "ÃŠtes-vous sÃ»r de vouloir supprimer cette lecture ?" }, class: "btn-delete-lecture" do %>
              ğŸ—‘
            <% end %>
          </div>
          </div>
        <% end %>
        </div>
      </div>

      <!-- Category Tabs -->
      <% @categories.each do |category| %>
        <div class="tab-pane" data-tabs-target="content" data-tab="<%= category.title.parameterize %>">
          <div class="lectures-grid">
            <% category.lectures.each do |lecture| %>
              <div class="lecture-card">
                <span class="lecture-card-badge">
                  <%= lecture.category.title %>
                </span>

                <h3 class="lecture-card-title">
                  <%= lecture.title %>
                </h3>

                <p class="lecture-card-resume">
                  <%= lecture.resume %>
                </p>

                <div class="lecture-card-stats">
                  <div class="stat-item">
                    <div class="stat-number">
                      <%= lecture.flashcards.count %>
                    </div>
                    <div class="stat-label">
                      Flashcards
                    </div>
                  </div>
                  <div class="stat-divider"></div>
                  <div class="stat-item">
                    <div class="stat-number">
                      <%= lecture.messages.count %>
                    </div>
                    <div class="stat-label">
                      Messages
                    </div>
                  </div>
                </div>

                <div class="lecture-card-actions">
                  <%= link_to lecture_path(lecture), class: "btn-view-lecture" do %>
                    <span>Voir la lecture</span>
                    <span>â†’</span>
                  <% end %>
                  <%= button_to lecture_path(lecture), method: :delete, data: { turbo_confirm: "ÃŠtes-vous sÃ»r de vouloir supprimer cette lecture ?" }, class: "btn-delete-lecture" do %>
                    ğŸ—‘
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Quizz View -->
      <div class="tab-pane" data-tabs-target="content" data-tab="quizz">
        <% if @quizzes.any? %>
          <% @categories.each do |category| %>
            <% category_quizzes = @quizzes.select { |q| q.lecture.category_id == category.id } %>
            <% if category_quizzes.any? %>
              <div class="quizz-category-section">
                <h3 class="quizz-category-title">
                  <span class="category-icon">ğŸ“</span>
                  <%= category.title %>
                  <span class="category-count">(<%= category_quizzes.count %> quizz)</span>
                </h3>
                <div class="quizz-grid">
                  <% category_quizzes.each do |quiz| %>
                    <%
                      questions = JSON.parse(quiz.content)
                      total = questions.count
                      completed = quiz.status || 0
                      percentage = total > 0 ? (completed.to_f / total * 100).round : 0
                    %>
                    <%= link_to quiz_path(quiz), class: "quizz-card-link" do %>
                      <div class="quizz-card">
                        <div class="quizz-card-header">
                          <div class="quizz-card-icon">
                            ğŸ§ 
                          </div>
                          <div class="quizz-card-badge" style="background: <%= percentage == 100 ? '#28a745' : '#1351AA' %>;">
                            <%= percentage %>%
                          </div>
                        </div>
                        <div class="quizz-card-body">
                          <h4 class="quizz-card-title"><%= quiz.lecture.title %></h4>
                          <div class="quizz-card-stats">
                            <span>ğŸ“ <%= total %> questions</span>
                            <span>âœ… <%= completed %> / <%= total %></span>
                          </div>
                        </div>
                      </div>
                    <% end %>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% end %>
        <% else %>
          <div class="empty-lectures">
            <div class="empty-icon">ğŸ§ </div>
            <h3>Aucun quizz disponible</h3>
            <p>GÃ©nÃ¨re des quizz depuis tes lectures pour valider tes connaissances !</p>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="empty-lectures">
        <div class="empty-icon">ğŸ“š</div>
        <h3>Aucune lecture pour le moment</h3>
        <p>Commence par ajouter ta premiere lecture</p>
        <%= link_to root_path, class: "btn-back-home" do %>
          <span>+</span>
          <span>Ajouter une lecture</span>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Back Button -->
  <div class="lectures-back-section">
    <%= link_to root_path, class: "btn-back-home" do %>
      <span>â†</span>
      <span>Retour a l'accueil</span>
    <% end %>
  </div>
</div>
